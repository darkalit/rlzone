<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RL Zone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/header.css" />
    <link rel="stylesheet" href="/assets/css/button.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
    <link rel="stylesheet" href="/assets/css/create-item.css" />
    <link rel="stylesheet" href="/assets/css/general.css" />
  </head>

  <body>
    {{template "header-admin.html"}}

    <main class="main">
      <form
        class="main-content"
        action="/items/create"
        method="post"
        id="createForm"
      >
        <div
          class="main-content-sidebar"
          style="width: 340px; padding: 0px 36px 0px 36px"
        >
          <div class="card grey-container">
            <img
              src="{{.item.Image}}"
              alt="car"
              style="width: 254px"
              id="itemImage"
            />
            <h1 class="car-name" id="itemName">{{.item.Name}}</h1>
            <div class="credit-block">
              <img
                src="/assets/img/Credits.svg"
                alt="credits"
                style="width: 24px; height: 24px"
              />
              <input
                class="credit-input grey-container-shade"
                type="number"
                placeholder="Enter price..."
                name="price"
              />
            </div>
            <div class="btn-block">
              <button
                id="changeItemBase"
                class="change-btn button-fill button-add-glow"
                type="button"
              >
                Change item base
              </button>
            </div>
          </div>
          <div class="btn-glow">
            <button
              class="button-gradient"
              type="submit"
              style="margin-top: 48px"
              onclick="submitForm(item)"
            >
              Create
            </button>
          </div>
        </div>
        <div class="main-content-block">
          <div class="main-description-table grey-container">
            <table class="main-table" id="itemTable"></table>
          </div>

          <div class="main-content-block-pages">
            <div class="main-block-description grey-container">
              <div class="block-description-title">
                <img src="/assets/img/note.svg" alt="note" />
                <h1 class="accent-text">Description</h1>
              </div>
              <textarea
                class="description-input grey-container-shade"
                type="text"
                placeholder="Enter description..."
                name="description"
              ></textarea>
            </div>
          </div>

          <div class="pages-filler"></div>
        </div>
      </form>
    </main>
    <div id="myModal" class="modal">
      <div class="grey-container-shade modal-content">
        <div class="modal-header">
          <div style="width: 100%">
            <span class="close" style="width: fit-content">&times;</span>
          </div>
          <h2>Find Item</h2>
        </div>
        <div class="modal-body">
          <div class="modal-search">
            <img src="/assets/img/MagnifyingGlass.svg" alt="magnifyingGlass" />
            <input
              class="modal-search-field"
              type="text"
              placeholder="Find an item..."
              id="itemsInput"
            />
            <button
              type="button"
              class="modal-search-button"
              id="getItemsListBtn"
            >
              âžœ
            </button>
          </div>
        </div>
        <div id="items"></div>
      </div>
    </div>

    {{template "footer.html"}}
  </body>

  <script>
    const modal = document.getElementById("myModal");
    const btn = document.getElementById("changeItemBase");
    const span = document.getElementsByClassName("close")[0];

    btn.onclick = function () {
      modal.style.display = "block";
    };

    span.onclick = function () {
      modal.style.display = "none";
    };

    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    };

    let item;
    const table = document.getElementById("itemTable");
    function changeItem(itemArg) {
      item = itemArg;
      document.getElementById("itemImage").src = item.Image;
      document.getElementById("itemName").innerText = item.Name;

      ["Image", "Stock"].forEach((e) => {
        delete item[e];
      });

      table.innerHTML = "";
      for (let k in item) {
        const tr = document.createElement("tr");
        [k, item[k]].forEach((e, index) => {
          if (e === false) {
            e = "No";
          }
          if (e === true) {
            e = "Yes";
          }


          const td = document.createElement("td");
          const text = document.createTextNode(e);

          td.appendChild(text);
          tr.appendChild(td);
        });

        table.appendChild(tr);
      }

      modal.style.display = "none";
    }

    changeItem({{ .item }})

    function submitForm(itemArg) {
      const id = document.createElement("input");
      id.type = "hidden";
      id.name = "item_id";
      id.value = itemArg.ID;

      document.getElementById("createForm").appendChild(id);
    }

    const getItemsButton = document.getElementById("getItemsListBtn");
    const itemsDiv = document.getElementById("items");
    const itemsInput = document.getElementById("itemsInput");
    getItemsButton.onclick = function (event) {
      fetch(`/items/list?name=${itemsInput.value}`)
        .then((res) => res.text())
        .then((html) => {
          itemsDiv.innerHTML = html;
        });
    };
  </script>
</html>
